<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Cluster Status</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent white background */
        backdrop-filter: blur(5px); /* Adjust the blur value as needed */
        z-index: 9998; /* Ensure it appears above other content, but below the loading message */
        display: none; /* Initially hidden */
    }

    #loading-message {
        font-size: 50px; /* Adjust the font size as needed */
        text-align: center;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999; /* Ensure it appears above other content */
        display: none; /* Initially hidden */
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1 class="mb-4">
    Cluster Status
    <span th:if="${clusterStatus}" style="color: green;">(ON)</span>
    <span th:unless="${clusterStatus}" style="color: red;">(OFF)</span>
  </h1>

  <div th:if="${errorMessage != null}" class="alert alert-danger">
    <p th:text="${errorMessage}"></p>
  </div>

  <form th:if="${clusterStatus == null}" th:action="@{/cluster/boot}" method="post">
    <button type="submit" class="btn btn-success" onclick="showLoadingMessage('Starting')">Start Cluster</button>
  </form>

  <form th:if="${clusterStatus != null}" th:action="@{/cluster/stop}" method="post">
    <button type="submit" class="btn btn-danger" onclick="showLoadingMessage('Stopping')">Stop Cluster</button>
  </form>

  <div id="loading-overlay"></div>

  <div id="loading-message" class="text-info" style="color: black !important;">
    Cluster is <span id="loading-action">starting</span>. Please wait...
  </div>

  <h2 class="mt-4" th:if="${clusterStatus}">Status:</h2>
  <table class="table table-bordered" th:if="${clusterStatus}">
    <thead>
    <tr>
      <th>Name</th>
      <th>Command</th>
      <th>State</th>
      <th>Ports</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="entry : ${clusterStatus}">
      <td th:text="${entry.key}"></td>
      <td th:text="${entry.value[0]}"></td>
      <td th:text="${entry.value[1]}"></td>
      <td th:text="${entry.value[2]}"></td>
    </tr>
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<script>
    function showLoadingMessage(action) {
        const loadingMessage = document.getElementById('loading-message');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingAction = document.getElementById('loading-action');

        if (loadingMessage && loadingOverlay && loadingAction) {
            loadingMessage.style.display = 'block'; // Show the loading message
            loadingOverlay.style.display = 'block'; // Show the overlay
            loadingAction.innerText = action; // Set the action text dynamically
        }

        let dots = 0;
        const intervalId = setInterval(() => {
            if (!loadingMessage || !loadingOverlay) {
                clearInterval(intervalId);
                return;
            }
            const progressDots = '.'.repeat(dots);
            loadingMessage.innerHTML = `<span style="color: black;">Cluster is ${action}${progressDots}.</span>`;
            dots = (dots + 1) % 4; // Cycle through 0, 1, 2, 3
        }, 1000); // Update every second
    }
</script>
</body>
</html>
